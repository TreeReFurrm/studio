{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the ReFurrm Scan platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "zipCode": {
          "type": "string",
          "description": "The user's primary ZIP code for location-based services."
        },
        "ambassadorId": {
          "type": "string",
          "description": "The ID of the Ambassador assigned to this user's region."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        },
        "tier": {
          "type": "string",
          "description": "The user's membership tier.",
          "enum": [
            "Community",
            "Pro",
            "Ambassador"
          ]
        },
        "roles": {
          "type": "array",
          "description": "A list of roles assigned to the user, e.g., 'Ambassador'.",
          "items": {
            "type": "string"
          }
        },
        "subscriptionStatus": {
          "type": "string",
          "description": "The current status of the user's subscription (if applicable).",
          "enum": [
            "active",
            "inactive",
            "past_due"
          ]
        },
        "stripeCustomerId": {
          "type": "string",
          "description": "The user's Stripe customer ID for billing."
        }
      },
      "required": [
        "id",
        "email",
        "tier"
      ]
    },
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an item listed on the ReFurrm Scan marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the item.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who listed this item."
        },
        "title": {
          "type": "string",
          "description": "Title of the item."
        },
        "description": {
          "type": "string",
          "description": "Description of the item."
        },
        "price": {
          "type": "number",
          "description": "The user-defined price of the item."
        },
        "aiEstimatedValue": {
          "type": "number",
          "description": "The market value of the item as estimated by AI."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image for the item.",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the item was listed.",
          "format": "date-time"
        },
        "category": {
          "type": "string",
          "description": "Category of the item."
        },
        "status": {
          "type": "string",
          "description": "The current status of the item in the marketplace.",
          "enum": [
            "listed",
            "sold",
            "shipped"
          ]
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "price",
        "imageUrl",
        "createdAt",
        "status"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a sale of an item on the ReFurrm Scan marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale.",
          "format": "uuid"
        },
        "itemId": {
          "type": "string",
          "description": "Reference to the Item that was sold."
        },
        "buyerId": {
          "type": "string",
          "description": "Reference to the User who purchased the item."
        },
        "sellerId": {
          "type": "string",
          "description": "Reference to the User who sold the item."
        },
        "ambassadorId": {
          "type": "string",
          "description": "The ID of the Ambassador who facilitated the sale, if any."
        },
        "saleDate": {
          "type": "string",
          "description": "Date of the sale.",
          "format": "date-time"
        },
        "salePrice": {
          "type": "number",
          "description": "Price at which the item was sold."
        },
        "ethicalContributionId": {
          "type": "string",
          "description": "Reference to the associated ethical contribution for this sale."
        }
      },
      "required": [
        "id",
        "itemId",
        "buyerId",
        "sellerId",
        "saleDate",
        "salePrice"
      ]
    },
    "Pickup": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Pickup",
      "type": "object",
      "description": "Represents a pickup request for a sold item.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the pickup request.",
          "format": "uuid"
        },
        "saleId": {
          "type": "string",
          "description": "Reference to the Sale for which the pickup is requested."
        },
        "pickupDate": {
          "type": "string",
          "description": "Date and time of the scheduled pickup.",
          "format": "date-time"
        },
        "address": {
          "type": "string",
          "description": "Address where the item needs to be picked up."
        },
        "status": {
          "type": "string",
          "description": "Status of the pickup request (e.g., requested, scheduled, completed)."
        }
      },
      "required": [
        "id",
        "saleId",
        "pickupDate",
        "address",
        "status"
      ]
    },
    "EthicalContribution": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EthicalContribution",
      "type": "object",
      "description": "Represents an ethical funding contribution made from a sale for the LEAN Foundation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the contribution.",
          "format": "uuid"
        },
        "saleId": {
          "type": "string",
          "description": "Reference to the Sale from which the contribution is made."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the ethical contribution."
        },
        "contributionDate": {
          "type": "string",
          "description": "Date of the contribution.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "saleId",
        "amount",
        "contributionDate"
      ]
    },
    "ServiceRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ServiceRequest",
      "type": "object",
      "description": "Represents a user's request for a specialized Ambassador service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the service request.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user making the request."
        },
        "serviceType": {
          "type": "string",
          "description": "The type of service requested.",
          "enum": ["cleanout", "organize", "downsize"]
        },
        "zipCode": {
          "type": "string",
          "description": "The ZIP code where the service is needed."
        },
        "notes": {
          "type": "string",
          "description": "Additional notes from the user about the service request, can include inventory scan results."
        },
        "status": {
          "type": "string",
          "description": "The current status of the request.",
          "enum": ["PENDING_MATCH", "MATCHED", "NO_MATCH_FOUND", "COMPLETED"]
        },
        "assignedAmbassadorId": {
          "type": "string",
          "description": "The ID of the matched Ambassador, if any."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the request was created.",
          "format": "date-time"
        }
      },
      "required": ["id", "userId", "serviceType", "zipCode", "status", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles, including their tier and subscription status.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/items/{itemId}",
        "definition": {
          "entityName": "Item",
          "schema": {
            "$ref": "#/backend/entities/Item"
          },
          "description": "This collection contains all items listed on the marketplace. It includes a denormalized 'userId' to enable ownership-based security rules.",
          "params": [
            {
              "name": "itemId",
              "description": "The unique identifier for the item."
            }
          ]
        }
      },
      {
        "path": "/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Sales data is stored in a top-level collection. It includes denormalized 'itemId', 'buyerId', and 'sellerId' for authorization and querying.",
          "params": [
            {
              "name": "saleId",
              "description": "The unique identifier for the sale."
            }
          ]
        }
      },
      {
        "path": "/pickups/{pickupId}",
        "definition": {
          "entityName": "Pickup",
          "schema": {
            "$ref": "#/backend/entities/Pickup"
          },
          "description": "Pickup requests for sold items.",
          "params": [
            {
              "name": "pickupId",
              "description": "The unique identifier for the pickup."
            }
          ]
        }
      },
      {
        "path": "/ethical_contributions/{contributionId}",
        "definition": {
          "entityName": "EthicalContribution",
          "schema": {
            "$ref": "##backend/entities/EthicalContribution"
          },
          "description": "A ledger for all ethical contributions made from sales.",
          "params": [
            {
              "name": "contributionId",
              "description": "The unique identifier for the contribution."
            }
          ]
        }
      },
      {
        "path": "/service_requests/{requestId}",
        "definition": {
          "entityName": "ServiceRequest",
          "schema": {
            "$ref": "#/backend/entities/ServiceRequest"
          },
          "description": "A collection of user requests for specialized Ambassador services.",
          "params": [
            {
              "name": "requestId",
              "description": "The unique identifier for the service request."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure has been updated to support the core business logic. The User entity now includes 'tier', 'subscriptionStatus', and 'stripeCustomerId' to manage user roles and billing. The Item entity has a 'status' to track its lifecycle (listed, sold, shipped) and 'aiEstimatedValue'. The Sale entity now more clearly separates seller and buyer IDs and links to an EthicalContribution, which is its own top-level collection to serve as a proper ledger for the LEAN Foundation. A new 'ServiceRequest' entity and collection have been added to handle specialized service requests, linking users to Ambassadors. This denormalized, segregated structure simplifies security rules and supports efficient queries for marketplace, user-specific, and administrative functions."
  }
}

    